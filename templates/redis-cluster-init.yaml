# apiVersion: batch/v1
# kind: Job
# metadata:
#   name: redis-cluster-init
#   namespace: {{ .Release.Namespace }}
# spec:
#   template:
#     spec:
#       restartPolicy: OnFailure
#       containers:
#         - name: redis-cluster-init
#           image: redis:7.2
#           command:
#             - "sh"
#             - "-c"
#             - |
#               echo "等待 Redis Pod 全部啟動..."
#               for i in $(seq 0 5); do
#                 until redis-cli -h redis-cluster-$i.redis-cluster-headless.{{ .Release.Namespace }}.svc.cluster.local ping | grep PONG; do
#                   echo "等待 redis-cluster-$i ..."
#                   sleep 2
#                 done
#               done
#               echo "全部節點啟動完畢，開始建立 cluster..."
#               yes yes | redis-cli --cluster create \
#                 redis-cluster-0.redis-cluster-headless.{{ .Release.Namespace }}.svc.cluster.local:6379 \
#                 redis-cluster-1.redis-cluster-headless.{{ .Release.Namespace }}.svc.cluster.local:6379 \
#                 redis-cluster-2.redis-cluster-headless.{{ .Release.Namespace }}.svc.cluster.local:6379 \
#                 redis-cluster-3.redis-cluster-headless.{{ .Release.Namespace }}.svc.cluster.local:6379 \
#                 redis-cluster-4.redis-cluster-headless.{{ .Release.Namespace }}.svc.cluster.local:6379 \
#                 redis-cluster-5.redis-cluster-headless.{{ .Release.Namespace }}.svc.cluster.local:6379 \
#                 --cluster-replicas 1
#               echo "Redis Cluster 建立完成 ✅"
#       # 可選：加上安全限制避免跑太多權限
#       securityContext:
#         runAsUser: 0
